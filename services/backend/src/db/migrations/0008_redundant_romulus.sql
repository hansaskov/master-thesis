CREATE MATERIALIZED VIEW "public"."system_health" WITH (timescaledb.continuous) AS (select time_bucket(INTERVAL '5 minutes', "readings"."time") as "bucket", "readings"."system_id", "readings"."category", "readings"."unit", "readings"."name", avg("readings"."value") as "average_reading", last("threshold"."threshold", "readings"."time") as "threshold", avg("readings"."value") < last("threshold"."threshold", "readings"."time") as "healthy" from "readings" inner join "threshold" on ("readings"."system_id" = "threshold"."system_id" and "readings"."category" = "threshold"."category" and "readings"."unit" = "threshold"."unit" and "readings"."name" = "threshold"."name") where "threshold"."enabled" = true group by "readings"."system_id", "readings"."category", "readings"."unit", "readings"."name", "bucket") WITH NO DATA;